<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Beers & Borders ‚Äî Kies het land</title>
<meta name="color-scheme" content="dark light" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#f6f8fb; --bg2:#eef2f7;
    --card:#ffffff; --ink:#0b1f17; --muted:#6b7f76;
    --btn-ink:#ffffff; --btn-ring:#2dd4bf55;
    --glass-stroke:#cfe0d8; --glass-fill1:#b5f0c6; --glass-fill2:#4cd186;
    --radius:18px; --ease:cubic-bezier(.2,.8,.2,1);
  }

  html,body{height:100%;margin:0}
  body{
    font-family:"Plus Jakarta Sans", system-ui, -apple-system, Segoe UI, Roboto, Arial;
    color:var(--ink);
    background:
      radial-gradient(1000px 600px at 20% -10%, #b9f7d733 0%, transparent 60%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
    overflow:hidden;
  }

  .app{
    width:min(960px,96vw); height:min(900px,96vh);
    margin:2vh auto;
    display:grid; grid-template-rows:auto 1fr; gap:16px;
  }

  /* Header */
  header{
    display:grid; grid-template-columns:1fr; align-items:center; gap:10px;
    padding:4px 0 2px;
    text-align:center;
  }
  .title{font-weight:800; letter-spacing:.2px; font-size:26px}

  .hud-row{
    display:flex; flex-direction:column; align-items:center; gap:8px;
  }
  .glasses-wrap{
    display:flex; align-items:flex-end; gap:10px; flex-wrap:wrap;
    min-height:72px;
    justify-content:center; /* centreren van glazen */
  }
  .glass{
    position:relative; width:30px; height:64px; border-radius:8px;
    background:linear-gradient(180deg,#f3f7f4,#e7efe9);
    box-shadow:inset 0 0 0 1px var(--glass-stroke), 0 3px 12px rgba(0,0,0,.08);
    overflow:hidden;
  }
  .glass .fill{
    position:absolute; left:4px; right:4px; bottom:4px; height:0%;
    border-radius:6px;
    background:linear-gradient(180deg,var(--glass-fill1),var(--glass-fill2) 70%,#22a65c);
    transition:height .25s var(--ease);
  }
  .streak{font-weight:800; color:var(--muted); padding-bottom:4px}

  /* Stage & kaart */
  .stage{
    position:relative; display:grid; align-content:start; justify-items:center;
    padding-top:8px;
  }
  .card{
    width:min(560px,92vw); height:min(440px,52vh);
    background:var(--card); border-radius:22px;
    box-shadow:0 18px 50px rgba(0,0,0,.08), 0 0 0 1px #dfe9e3;
    display:grid; grid-template-rows: 1fr auto; gap:16px; padding:20px;
  }
  .flag{
    font-size:min(16vmin,96px); display:grid; place-items:center;
    text-align:center; filter:drop-shadow(0 6px 18px rgba(0,0,0,.06));
  }

  /* Knoppen */
  .choices{
    display:flex; gap:14px; justify-content:center; align-items:center; flex-wrap:wrap;
    margin-top:auto;
  }
  .btn{
    appearance:none; border:1px solid var(--btn-ring);
    background:linear-gradient(180deg,#06b6d4,#0b1324);
    color:var(--btn-ink);
    padding:16px 20px; border-radius:16px; font-weight:800; font-size:18px;
    min-width:240px; cursor:pointer; letter-spacing:.2px;
    box-shadow:
      0 1px 0 #ffffff10 inset,
      0 10px 30px rgba(0,0,0,.10),
      0 0 0 0 rgba(34,211,238,.0);
    transition:
      transform .08s var(--ease),
      box-shadow .15s var(--ease),
      border-color .15s var(--ease),
      filter .15s var(--ease);
  }
  .btn:hover{
    transform:translateY(-1px);
    box-shadow:
      0 1px 0 #ffffff10 inset,
      0 14px 38px rgba(0,0,0,.14),
      0 0 0 4px rgba(34,211,238,.20);
    filter:saturate(110%);
    border-color:#22d3eeaa;
  }
  .btn:active{transform:translateY(1px) scale(.99)}

  /* Overlays */
  .fail-stage{position:fixed; inset:0; display:none; place-items:center;
    background:rgba(0,0,0,.55); z-index:9998; padding:24px}
  .fail-box{display:flex; flex-direction:column; align-items:center; gap:12px}
  .fail-pair{
    width:min(92vw,560px);
    color:#e7efe9; opacity:.95; font-size:15px; font-weight:800;
    text-align:center; text-shadow:0 1px 4px rgba(0,0,0,.45)
  }
  #failGif{max-width:min(92vw,520px); max-height:64vh; border-radius:14px; box-shadow:0 10px 40px rgba(0,0,0,.6)}
  .fail-text{font-weight:900; font-size:20px; color:#fafff7; text-shadow:0 2px 8px rgba(0,0,0,.5)}
  .fail-count{font-size:40px; font-weight:900; color:#e6ff68; text-shadow:0 4px 10px rgba(0,0,0,.7)}

  #startOverlay{position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.6); z-index:10000}
  .cta{padding:16px 28px; font-size:20px; font-weight:900; border-radius:14px; border:0; cursor:pointer;
    color:#021b10; background:linear-gradient(180deg,#a7f3d0,#34d399); box-shadow:0 10px 30px #22c55e44}
  .gate{position:fixed; bottom:16px; left:50%; transform:translateX(-50%);
    padding:10px 16px; background:#103a24; border-radius:999px; color:#d9ffdf; font-weight:800; z-index:10000; display:none}

  /* Mobiel */
  @media (max-width:560px){
    .glasses-wrap{min-height:64px}
    .glass{width:26px; height:56px}
    .card{height:54vh; padding:18px}
    .choices{flex-direction:column}
    .btn{min-width:unset; width:100%; font-size:16px}
  }
</style>
</head>
<body>
<div class="app" role="application">
  <header>
    <div class="title">Beers & Borders</div>
    <div class="hud-row" aria-label="Streak">
      <div class="glasses-wrap" id="glasses"></div>
      <div class="streak"><span id="sipCount">0</span> slokken</div>
    </div>
  </header>

  <main class="stage">
    <div class="card" id="card">
      <div class="flag" id="flag" aria-live="polite">üè≥Ô∏è</div>
      <div class="choices">
        <button class="btn" id="leftBtn">Optie links</button>
        <button class="btn" id="rightBtn">Optie rechts</button>
      </div>
    </div>
  </main>
</div>

<!-- Start overlay -->
<div id="startOverlay">
  <button class="cta" id="startBtn">Start</button>
</div>

<!-- Fail overlay -->
<div class="fail-stage" id="failStage">
  <div class="fail-box">
    <div class="fail-pair" id="failPair"></div>
    <img id="failGif" src="giphy.gif" alt="Fail animatie">
    <div class="fail-text" id="failMsg"></div>
    <div class="fail-text">Totaal slokken deze streak:</div>
    <div class="fail-count" id="failCount">0</div>
  </div>
</div>

<!-- Gate button for sound -->
<button id="gateBtn" class="gate">üîä Enable sound</button>

<script>
/* ---- Config ---- */
const FAIL_SFX_PATH = "soundeffect.mp3";
const SIPS_PER_GLASS = 24;
const FAIL_MESSAGE  = "Oef‚Ä¶ verkeerde keuze.";

/* ---- Data ---- */
const COUNTRIES = [
  {name:"Netherlands", iso:"NL"}, {name:"Belgium", iso:"BE"}, {name:"Germany", iso:"DE"},
  {name:"France", iso:"FR"}, {name:"Spain", iso:"ES"}, {name:"Italy", iso:"IT"}, {name:"Portugal", iso:"PT"},
  {name:"United Kingdom", iso:"GB"}, {name:"Ireland", iso:"IE"}, {name:"Sweden", iso:"SE"}, {name:"Norway", iso:"NO"},
  {name:"Finland", iso:"FI"}, {name:"Poland", iso:"PL"}, {name:"Czech Republic", iso:"CZ"},
  {name:"Austria", iso:"AT"}, {name:"Switzerland", iso:"CH"}, {name:"Greece", iso:"GR"}, {name:"Turkey", iso:"TR"},
  {name:"Ukraine", iso:"UA"}, {name:"Russia", iso:"RU"}, {name:"United States", iso:"US"}, {name:"Canada", iso:"CA"},
  {name:"Mexico", iso:"MX"}, {name:"Brazil", iso:"BR"}, {name:"Argentina", iso:"AR"}, {name:"Chile", iso:"CL"},
  {name:"Colombia", iso:"CO"}, {name:"Peru", iso:"PE"}, {name:"Japan", iso:"JP"}, {name:"South Korea", iso:"KR"},
  {name:"China", iso:"CN"}, {name:"India", iso:"IN"}, {name:"Pakistan", iso:"PK"}, {name:"Bangladesh", iso:"BD"},
  {name:"Indonesia", iso:"ID"}, {name:"Australia", iso:"AU"}, {name:"New Zealand", iso:"NZ"}, {name:"South Africa", iso:"ZA"},
  {name:"Egypt", iso:"EG"}, {name:"Morocco", iso:"MA"}, {name:"Nigeria", iso:"NG"}, {name:"Kenya", iso:"KE"},
  {name:"Ghana", iso:"GH"}, {name:"Saudi Arabia", iso:"SA"}, {name:"United Arab Emirates", iso:"AE"},
  {name:"Qatar", iso:"QA"}, {name:"Israel", iso:"IL"}, {name:"Iran", iso:"IR"}, {name:"Iraq", iso:"IQ"},
  {name:"Iceland", iso:"IS"}, {name:"Jamaica", iso:"JM"}, {name:"Kosovo", iso:"XK"},
  {name:"Taiwan", iso:"TW"}, {name:"Hong Kong", iso:"HK"}, {name:"Singapore", iso:"SG"}, {name:"Malaysia", iso:"MY"},
  {name:"Philippines", iso:"PH"}, {name:"Vietnam", iso:"VN"}, {name:"Thailand", iso:"TH"}, {name:"Sri Lanka", iso:"LK"},
  {name:"Ethiopia", iso:"ET"}, {name:"Algeria", iso:"DZ"}, {name:"Tunisia", iso:"TN"}, {name:"Zimbabwe", iso:"ZW"},
  {name:"Liberia", iso:"LR"}, {name:"Honduras", iso:"HN"}, {name:"Nicaragua", iso:"NI"}, {name:"Panama", iso:"PA"}
];

/* ---- Kleur-tags (voor look-alike matchups) ---- */
const COLORS = {
  NL:['red','white','blue'], BE:['black','yellow','red'], DE:['black','red','yellow'],
  FR:['blue','white','red'], ES:['red','yellow'], IT:['green','white','red'], PT:['green','red','yellow'],
  GB:['red','white','blue'], IE:['green','white','orange'], SE:['blue','yellow'], NO:['red','white','blue'],
  FI:['blue','white'], PL:['white','red'], CZ:['red','white','blue'],
  AT:['red','white'], CH:['red','white'], GR:['blue','white'], TR:['red','white'],
  UA:['blue','yellow'], RU:['white','blue','red'], US:['red','white','blue'], CA:['red','white'],
  MX:['green','white','red'], BR:['green','yellow','blue'], AR:['blue','white','yellow'], CL:['red','white','blue'],
  CO:['yellow','blue','red'], PE:['red','white'], JP:['white','red'], KR:['white','red','blue','black'],
  CN:['red','yellow'], IN:['orange','white','green','blue'], PK:['green','white'], BD:['green','red'],
  ID:['red','white'], AU:['blue','white','red'], NZ:['blue','white','red'], ZA:['green','yellow','red','blue','black','white'],
  EG:['red','white','black','gold'], MA:['red','green'], NG:['green','white'], KE:['black','red','green','white'],
  GH:['red','yellow','green','black'], SA:['green','white'], AE:['red','green','white','black'],
  QA:['maroon','white'], IL:['blue','white'], IR:['green','white','red'], IQ:['red','white','black','green'],
  IS:['blue','white','red'], JM:['green','yellow','black'], XK:['blue','yellow'], TW:['red','white','blue'],
  HK:['red','white'], SG:['red','white'], MY:['blue','yellow','red','white'], PH:['blue','red','white','yellow'],
  VN:['red','yellow'], TH:['red','white','blue'], LK:['maroon','yellow','green','orange'],
  ET:['green','yellow','red','blue'], DZ:['green','white','red'], TN:['red','white'], ZW:['green','yellow','red','black','white'],
  LR:['red','white','blue'], HN:['blue','white'], NI:['blue','white'], PA:['red','white','blue']
};

/* ---- State ---- */
let streak = 1;
let current = null;     // {iso, correct, left, right, side}
let sfx = null;

/* ---- No-repeat window (10 hoofdvlaggen) ---- */
const recentMainISOs = [];
const recentMainSet  = new Set();
function rememberMainISO(iso){
  recentMainISOs.push(iso);
  recentMainSet.add(iso);
  if(recentMainISOs.length > 10){
    const old = recentMainISOs.shift();
    if(!recentMainISOs.includes(old)) recentMainSet.delete(old);
  }
}

/* ---- Utils ---- */
function rand(n){ return Math.floor(Math.random()*n); }
function sample(arr){ return arr[arr.length ? rand(arr.length) : 0]; }
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=rand(i+1); [a[i],a[j]]=[a[j],a[i]]; } }
function isoToFlag(iso){ const cc = iso.toUpperCase(); return String.fromCodePoint(...[...cc].map(c=>0x1F1E6 + (c.charCodeAt(0)-65))); }

/* Bepaal kandidaten met overlappende colortags */
function similarCountries(iso){
  const base = COLORS[iso] || [];
  if(base.length===0) return [];
  return COUNTRIES.filter(c=>{
    if(c.iso===iso) return false;
    const tags = (COLORS[c.iso] || []);
    return tags.some(t => base.includes(t));
  });
}

/* ---- Pairing: A random (excl. laatste 10), B MOET (indien mogelijk) minstens 1 kleur delen ---- */
function pickPair(){
  const candidates = COUNTRIES.filter(c => !recentMainSet.has(c.iso));
  const pool = candidates.length ? candidates : COUNTRIES;
  const a = sample(pool);

  let similars = similarCountries(a.iso);
  let b;
  if(similars.length){
    b = sample(similars);
  }else{
    do{ b = sample(COUNTRIES); } while(b.iso===a.iso);
  }

  const leftIsCorrect = Math.random()<.5;
  return {
    iso:a.iso,
    correct:a.name,
    left:leftIsCorrect?a.name:b.name,
    right:leftIsCorrect?b.name:a.name,
    side:leftIsCorrect?"left":"right"
  };
}

/* ---- Gauge met GLASSEN ---- */
const glassesEl = document.getElementById('glasses');
const sipCountEl = document.getElementById('sipCount');
function makeGlass(percent){
  const g=document.createElement('div'); g.className='glass';
  const f=document.createElement('div'); f.className='fill'; f.style.height=percent+'%';
  g.appendChild(f); return g;
}
function updateGauge(){
  glassesEl.innerHTML="";
  const total = streak;
  const full = Math.floor(total / SIPS_PER_GLASS);
  const rem  = total % SIPS_PER_GLASS;
  for(let i=0;i<full;i++) glassesEl.appendChild(makeGlass(100));
  glassesEl.appendChild(makeGlass((rem===0 && total>0)?100:(rem/SIPS_PER_GLASS)*100));
  sipCountEl.textContent = String(streak);
}

/* ---- UI refs ---- */
const flagEl = document.getElementById('flag');
const leftBtn = document.getElementById('leftBtn');
const rightBtn = document.getElementById('rightBtn');
const startOverlay = document.getElementById('startOverlay');
const startBtn = document.getElementById('startBtn');
const gateBtn = document.getElementById('gateBtn');
const failStage = document.getElementById('failStage');
const failCount = document.getElementById('failCount');
const failPair = document.getElementById('failPair');
const failMsg = document.getElementById('failMsg');

/* ---- Sound ---- */
function ensureSfx(){ if(!sfx){ sfx = new Audio(FAIL_SFX_PATH); sfx.preload="auto"; sfx.volume=1.0; } return sfx; }
function tryPlay(el){ const p = el.play(); if(p!==undefined){ p.catch(()=> gateBtn.style.display='block'); }}

/* ---- Render ---- */
function renderCard(){
  const next = pickPair();
  rememberMainISO(next.iso);

  current = next;
  flagEl.textContent = isoToFlag(current.iso);
  leftBtn.textContent = current.left;
  rightBtn.textContent = current.right;
}

/* ---- Answers ---- */
function answer(side){
  const ok = (side === current.side);

  if(ok){
    streak++; updateGauge();
    renderCard();
  }else{
    const prev = streak;
    const flagEmoji = isoToFlag(current.iso);
    const chosenName = side==='left' ? current.left : current.right;
    failPair.textContent = `Je koppelde ${flagEmoji} aan ‚Äú${chosenName}‚Äù ‚Äî correct was ‚Äú${current.correct}‚Äù.`;
    failMsg.textContent = FAIL_MESSAGE;

    streak = 1; updateGauge();
    try{ ensureSfx(); tryPlay(sfx); }catch(e){}
    failCount.textContent = String(prev);
    failStage.style.display='grid';

    const dismiss = () => {
      failStage.style.display='none';
      window.removeEventListener('click', dismiss, true);
      window.removeEventListener('touchstart', dismiss, true);
      renderCard();
    };
    setTimeout(()=>{ 
      window.addEventListener('click', dismiss, true);
      window.addEventListener('touchstart', dismiss, true);
    }, 150);
  }
}

/* ---- Interactions ---- */
leftBtn.addEventListener('click', ()=>answer('left'));
rightBtn.addEventListener('click', ()=>answer('right'));

/* ---- Start & Gate ---- */
startBtn.addEventListener('click', ()=>{
  startOverlay.style.display='none';
  updateGauge();
  renderCard();
}, {once:true});

gateBtn.addEventListener('click', ()=>{
  try{ if(sfx){ sfx.play().then(()=> gateBtn.style.display='none'); } }catch(e){}
});

/* ---- Init ---- */
shuffle(COUNTRIES);
</script>
</body>
</html>
